<<<<<<< HEAD
{"version":3,"sources":["../babel/app.js"],"names":["document","addEventListener","e","loadTemplate","$","on","copyTextarea","querySelector","select","successful","execCommand","msg","addClass","setTimeout","removeClass","err","API","getCv","data","domParser","DOMParser","template","parseFromString","templateHtml","getElementById","templateStyles","getElementsByTagName","prepend","append","window","isEditing","prepareToEditTemplate","statusBarDom","statusBar","StatusBar","zones","i","length","Zone","blocks","Block","element","_element","closeButton","_hide","bind","_isActive","_animationTimeoutId","message","classList","remove","messageEl","innerHTML","_show","error","add","clearTimeout","Promise","resolve","reject","then","_showBar","zone","_addBlock","_createAddBlock","_enableDragNDrop","zoneName","getAttribute","zoneTypes","JSON","parse","blockWrapper","createElement","button","_showAddBlockList","appendChild","zonesList","type","listItem","_addNewBlock","listImg","setAttribute","location","origin","listName","name","getBlock","block","newBlock","find","before","showMessage","sortable","connectWith","items","handle","cancel","helper","appendTo","zIndex","delay","placeholder","activate","ui","beforeStop","change","create","deactivate","out","over","receive","item","types","target","map","obj","indexOf","sender","hasClass","sort","start","undefined","stop","update","_blockType","dataset","blockType","_childBlockType","_createControls","_fixPlaceholders","childBlockType","_createMicroBlockControls","_enableMicroBlockDragNDrop","blockActionsWrapper","itemPlaceholder","moveButton","editButton","edit","deleteButton","delete","saveButton","save","firstChild","removeChild","placeholders","el","html","deleteMicroBlock","_addMicroBlock","editableElements","querySelectorAll","key","toggle","_isEditing","sliders","parent","slider","range","min","max","after","_toggleEditing","counter","blockId","keysCount","sameKeysCount","j","push","console","log","saveBlock","parentNode","detach","cb","ajax","url","templateUrl","success","complete","apiUrl","templateId","decodeURIComponent","replace","cvId","method"],"mappings":"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","file":"app.js","sourcesContent":["document.addEventListener(\"DOMContentLoaded\", (e) => {\n  loadTemplate();\n});\n\n$('.edit-url-btn').on('click', () => {\n  var copyTextarea = document.querySelector('.edit-url');\n  copyTextarea.select();\n\n  try {\n    var successful = document.execCommand('copy');\n    var msg = successful ? 'successful' : 'unsuccessful';\n\n    $('.text-copied').addClass('active');\n    setTimeout(function() {\n      $('.text-copied').removeClass('active');\n    }, 500);\n  } catch (err) {}\n});\n\nlet loadTemplate = () => {\n  API.getCv((data) => {\n    let domParser = new DOMParser();\n    let template = domParser.parseFromString(data, \"text/html\");\n    let templateHtml = template.getElementById('main-wrap');\n    let templateStyles = template.getElementsByTagName('link');\n\n    //Add template HTML\n    $('#template').prepend(templateHtml);\n\n    //Add template styles\n    $('head').append(templateStyles);\n\n    if(window.isEditing) {\n      prepareToEditTemplate();\n    }\n\n    //Add timeout to remove twitches after loading template\n    setTimeout(() => {\n      $('#loader').removeClass('active');\n    }, 1000);\n  });\n}\n\nlet prepareToEditTemplate = () => {\n  let statusBarDom = $('#status-bar');\n  window.statusBar = new StatusBar(statusBarDom);\n\n  //Setup zones\n  let zones = $('[data-zone-block-types]');\n  for (let i = 0; i < zones.length; i++) {\n    new Zone(zones[i]);\n  }\n\n  //Setup blocks\n  let blocks = $('[data-block-id]');\n  for (let i = 0; i < blocks.length; i++) {\n    new Block(blocks[i]);\n  }\n}\n\nclass StatusBar {\n  constructor(element) {\n    this._element = element[0];\n\n    let closeButton = this._element.querySelector('.close');\n    closeButton.addEventListener('click', this._hide.bind(this), false);\n\n    this._isActive = false;\n    this._animationTimeoutId = null;\n  }\n\n  showMessage(message) {\n    this._element.classList.remove('is-error');\n\n    let messageEl = this._element.querySelector('.message');\n    messageEl.innerHTML = message;\n    // this._element.querySelector('.action')\n\n    this._show();\n  }\n\n  showError(error) {\n    this._element.classList.add('is-error');\n\n    let messageEl = this._element.querySelector('.message');\n    messageEl.innerHTML = error;\n\n    this._show();\n  }\n\n  _showBar() {\n    this._element.classList.add('is-active');\n    this._isActive = true;\n\n    clearTimeout(this._animationTimeoutId);\n    this._animationTimeoutId = setTimeout(this._hide.bind(this), 5000);\n  }\n\n  _show() {\n    if(this._isActive) {\n      new Promise((resolve, reject) => {\n        this._hide();\n        setTimeout(resolve, 250);\n      }).then(this._showBar.bind(this));\n    }\n    else {\n      this._showBar();\n    }\n  }\n\n  _hide() {\n    this._element.classList.remove('is-active');\n    this._isActive = false;\n  }\n}\n\nclass Zone {\n  constructor(zone) {\n    this._addBlock = null;\n    this._element = zone;\n\n    this._createAddBlock();\n    this._enableDragNDrop();\n  }\n\n  _createAddBlock() {\n    const zoneName = this._element.getAttribute('data-zone');\n    const zoneTypes = JSON.parse(this._element.getAttribute('data-zone-block-types'));\n\n    let blockWrapper = document.createElement('div');\n    blockWrapper.classList.add('add-block');\n\n    let button = document.createElement('button');\n    button.innerHTML = 'Add block';\n    button.addEventListener('click', this._showAddBlockList.bind(this), false);\n    blockWrapper.appendChild(button);\n\n    let zonesList = document.createElement('ul');\n    zonesList.classList.add('add-block-items', 'clearfix');\n    blockWrapper.appendChild(zonesList)\n\n    for(let type of zoneTypes) {\n      let listItem = document.createElement('li');\n      listItem.addEventListener('click', () => this._addNewBlock(zoneName, type), false);\n\n      let listImg = document.createElement('img');\n      listImg.classList.add('icon');\n      listImg.setAttribute('src', `${window.location.origin}/img/add-block-${type.type}.png`);\n      listItem.appendChild(listImg);\n\n      let listName = document.createElement('span');\n      listName.classList.add('title');\n      listName.innerHTML = type.name;\n      listItem.appendChild(listName);\n\n      zonesList.appendChild(listItem);\n    }\n\n    this._element.appendChild(blockWrapper);\n    this._addBlock = blockWrapper;\n  }\n\n  _showAddBlockList() {\n    this._addBlock.classList.add('is-active');\n  }\n\n  _addNewBlock(zoneName, type) {\n    this._addBlock.classList.remove('is-active');\n\n    API.getBlock(type.type, (block) => {\n      let newBlock = $(block)[0];\n\n      $(`[data-zone=\"${zoneName}\"]`).find('.add-block').before(newBlock);\n      new Block(newBlock);\n\n      window.statusBar.showMessage(`You have just added ${type.name} block`);\n    });\n  }\n\n  _enableDragNDrop() {\n    $(this._element).sortable({\n      connectWith: '[data-zone]',\n      items: '.item',\n      handle: '.move-block',\n      cancel: '',\n      helper: 'clone',\n      appendTo: 'body',\n      zIndex: 10000,\n      delay: 100,\n      placeholder: 'placeholder',\n      activate: (e, ui) => {},\n      beforeStop: (e, ui) => {},\n      change: (e, ui) => {},\n      create: (e, ui) => {},\n      deactivate: (e, ui) => {},\n      out: (e, ui) => {},\n      over: (e, ui) => {},\n      receive: (e, ui) => {\n        let type = $(ui.item).data('blockType');\n        let types = $(e.target).data('zoneBlockTypes').map((obj) => obj.type);\n\n        if (types.indexOf(type) === -1) {\n          $(ui.sender).sortable('cancel');\n        }\n\n        if ($(zones[i]).hasClass('ui-sortable')) {\n          $('[data-zone]').sortable('enable');\n        }\n      },\n      remove: (e, ui) => {},\n      sort: (e, ui) => {},\n      start: (e, ui) => {\n        let type = $(ui.item).data('blockType');\n        let zones = $('[data-zone]');\n\n        for(let i = 0; i < zones.length; i++) {\n          let types = [];\n          if ($(zones[i]).data('zoneBlockTypes') !== undefined) {\n            types = $(zones[i]).data('zoneBlockTypes').map((obj) => obj.type);\n          }\n\n          if (types.indexOf(type) === -1 && $(zones[i]).hasClass('ui-sortable')) {\n            $(zones[i]).sortable('disable');\n          }\n        }\n      },\n      stop: (e, ui) => {},\n      update: (e, ui) => {}\n    });\n  }\n}\n\nclass Block {\n  constructor(block) {\n    this._addBlock = null;\n    this._element = block;\n    this._blockType = block.dataset.blockType;\n    this._childBlockType = null;\n    \n    this._createControls();\n    this._fixPlaceholders();\n\n    if ($(block).find('[data-key=\"blocks\"]').length != 0) {\n      this._childBlockType = $(block).find('[data-key=\"blocks\"]')[0].dataset.childBlockType;\n\n      this._createMicroBlockControls();\n      this._enableMicroBlockDragNDrop();\n      this._createAddBlock();\n    }\n  }\n\n  _createControls() {\n    let blockWrapper = document.createElement('div');\n    blockWrapper.classList.add('editable-block');\n\n    let blockActionsWrapper = document.createElement('div');\n    blockActionsWrapper.classList.add('block-actions');\n    blockWrapper.appendChild(blockActionsWrapper);\n\n    let itemPlaceholder = document.createElement('div');\n    itemPlaceholder.classList.add('item-placeholder');\n    itemPlaceholder.innerHTML = this._element.innerHTML;\n    blockWrapper.appendChild(itemPlaceholder);\n\n    if (JSON.parse(this._element.getAttribute('data-is-draggable')) === true) {\n      let moveButton = document.createElement('button');\n      moveButton.classList.add('move', 'move-block');\n      blockActionsWrapper.appendChild(moveButton);\n    }\n\n    if (JSON.parse(this._element.getAttribute('data-is-editable')) === true) {\n      let editButton = document.createElement('button');\n      editButton.classList.add('edit');\n      editButton.innerHTML = 'Edit';\n      editButton.addEventListener('click', this.edit.bind(this), false);\n      blockActionsWrapper.appendChild(editButton);\n    }\n\n    if (JSON.parse(this._element.getAttribute('data-is-deletable')) === true) {\n      let deleteButton = document.createElement('button');\n      deleteButton.classList.add('delete');\n      deleteButton.innerHTML = 'Delete';\n      deleteButton.addEventListener('click', this.delete.bind(this), false);\n      blockActionsWrapper.appendChild(deleteButton);\n    }\n\n    if (JSON.parse(this._element.getAttribute('data-is-editable')) === true) {\n      let saveButton = document.createElement('button');\n      saveButton.classList.add('save');\n      saveButton.innerHTML = 'Save';\n      saveButton.addEventListener('click', this.save.bind(this), false);\n      blockActionsWrapper.appendChild(saveButton);\n    }\n\n    while (this._element.firstChild) {\n      this._element.removeChild(this._element.firstChild);\n    }\n\n    this._element.appendChild(blockWrapper);\n  }\n\n  _fixPlaceholders() {\n    let placeholders = $(this._element).find('[data-placeholder]');\n    for(let i = 0; i < placeholders.length; i++) {\n      let el = $(placeholders[i])[0];\n      let placeholder = el.dataset.placeholder;\n      if(el.innerHTML.indexOf('{{') > -1) {\n        $(el).html(placeholder);\n      }\n    }\n  }\n\n  _createMicroBlockControls() {\n    $('[data-key=\"blocks\"] > div, [data-key=\"blocks\"] > li').addClass('editable-micro-block');\n\n    let blockActionsWrapper = document.createElement('div');\n    blockActionsWrapper.classList.add('block-actions');\n\n    let moveButton = document.createElement('button');\n    moveButton.classList.add('move', 'move-micro-block');\n    blockActionsWrapper.appendChild(moveButton);\n\n    let deleteButton = document.createElement('button');\n    deleteButton.classList.add('delete');\n    deleteButton.innerHTML = 'Delete';\n    $(deleteButton).on('click', this.deleteMicroBlock.bind(this));\n    blockActionsWrapper.appendChild(deleteButton);\n\n    $('[data-key=\"blocks\"] > div, [data-key=\"blocks\"] > li').remove('.block-actions');\n    $('[data-key=\"blocks\"] > div, [data-key=\"blocks\"] > li').append(blockActionsWrapper);\n  }\n\n  _enableMicroBlockDragNDrop() {\n    $('[data-key=\"blocks\"]').sortable({\n      // connectWith: '',\n      items: '> div, > li',\n      handle: '.move-micro-block',\n      cancel: '',\n      // helper: 'clone',\n      appendTo: 'body',\n      zIndex: 10000,\n      delay: 100,\n      placeholder: 'placeholder',\n      activate: (e, ui) => {},\n      beforeStop: (e, ui) => {},\n      change: (e, ui) => {},\n      create: (e, ui) => {},\n      deactivate: (e, ui) => {},\n      out: (e, ui) => {},\n      over: (e, ui) => {},\n      receive: (e, ui) => {},\n      remove: (e, ui) => {},\n      sort: (e, ui) => {},\n      start: (e, ui) => {},\n      stop: (e, ui) => {},\n      update: (e, ui) => {}\n    });\n  }\n\n  _createAddBlock() {\n    let blockWrapper = document.createElement('div');\n    blockWrapper.classList.add('add-micro-block');\n\n    let button = document.createElement('button');\n    button.innerHTML = 'Add Micro block';\n    button.addEventListener('click', this._addMicroBlock.bind(this), false);\n    blockWrapper.appendChild(button);\n    $(this._element).find('.editable-block').append(blockWrapper);\n  }\n\n  _addMicroBlock() {\n    API.getBlock(this._childBlockType, (block) => {\n      $(this._element).find('[data-key=\"blocks\"]').append(block);\n      this._createMicroBlockControls();\n      this._fixPlaceholders();\n\n      //TODO: refactor edit function\n      let editableElements = this._element.querySelectorAll('[data-key]');\n      for (let i = 0; i < editableElements.length; i++) {\n        const key = editableElements[i].getAttribute('data-key');\n        if(['skill', 'blocks'].indexOf(key) === -1) {\n          editableElements[i].setAttribute('contenteditable', true);\n        }\n      }\n    });\n  }\n\n  _toggleEditing() {\n    this._element.querySelector('.editable-block').classList.toggle('is-editing');\n    this._isEditing = !this._isEditing;\n  }\n\n  edit() {\n    let editableElements = this._element.querySelectorAll('[data-key]');\n    for (let i = 0; i < editableElements.length; i++) {\n      const key = editableElements[i].getAttribute('data-key');\n      if(['blocks'].indexOf(key) === -1) {\n        editableElements[i].setAttribute('contenteditable', true);\n      }\n    }\n\n    // console.log($(this._element).find('.skills'))\n\n\n    let sliders = $(this._element).find('.skills'); //.after(slider);\n    for(let i = 0; i < sliders.length; i++) {\n      // console.log($(sliders[i]).parent().find('.slider').length)\n      if($(sliders[i]).parent().find('.slider').length === 0) {\n        let slider = document.createElement('div');\n        slider.classList.add('slider');\n        $(slider).slider({\n          range: 'max',\n          min: 0,\n          max: 10\n        });\n        $(sliders[i]).after(slider);\n      }\n    }\n\n    this._toggleEditing();\n  }\n\n  save() {\n    let editableElements = this._element.querySelectorAll('[data-key]');\n\n    //Data saving\n    let counter = 0;\n    let data = {};\n    data['blockId'] = this._element.dataset.blockId || 0;\n    data['blockType'] = this._element.dataset.blockType;\n    data['zone'] = $(this._element).parent().data('zone'); \n    data['fields'] = {};\n\n    for (let i = 0; i < editableElements.length; i++) {\n        if (['blocks'].indexOf(editableElements[i].getAttribute('data-key')) === -1) {\n            editableElements[i].setAttribute('contenteditable', false);\n        }\n    }\n    for (let i = 0; i < editableElements.length; i++) {\n\n      if(editableElements[i].getAttribute('data-key') !== 'blocks') {\n        if(data['fields']['blocks'] !== undefined) {  \n          const keysCount = $(this._element).find('[data-key=\"blocks\"]').find('[data-key]');\n          const sameKeysCount = $(this._element).find('[data-key=\"blocks\"]').find('[data-key=\"' + keysCount[0].getAttribute('data-key') + '\"]')\n          // console.log(keysCount.length, sameKeysCount.length);\n          let obj = {};\n          for(let j = 0; j < (keysCount.length / sameKeysCount.length); j++) {\n            obj[editableElements[i + j].getAttribute('data-key')] = editableElements[i + j].innerHTML;\n            // console.log(i, j);\n          }\n\n          i+= keysCount.length / sameKeysCount.length - 1;\n          // console.log(obj);\n          data['fields']['blocks'].push(obj);\n        }\n        else {\n          data['fields'][editableElements[i].getAttribute('data-key')] = editableElements[i].innerHTML;  \n        }\n      }\n      else {\n        data['fields']['blocks'] = [];\n      }\n    }\n\n    console.log(data);\n    API.saveBlock(data, () => {\n\n    });\n\n    this._toggleEditing();\n  }\n\n  delete() {\n    this._element.parentNode.removeChild(this._element);\n    \n    window.statusBar.showMessage('You have just deleted block');\n  }\n\n  deleteMicroBlock(e) {\n    $(e.target).parent().parent().detach();\n  }\n};\n\nconst API = {\n  getCv: (cb) => {\n    $.ajax({\n      url: window.templateUrl,\n      success: (data) => {\n        cb(data);\n      },\n      complete: () => {},\n      error: () => {}\n    });\n  },\n\n  getBlock: (type, cb) => {\n    $.ajax({\n      url: `${apiUrl}/block/${window.templateId}/${type}`,\n      success: (data) => {\n        let block = decodeURIComponent(JSON.parse(data).data).replace(/\\+/g, ' ');\n\n        cb(block);\n      },\n      complete: () => {},\n      error: () => {}\n    });\n  },\n\n  saveBlock: (block, cb) => {\n    block.cvId = cvId;\n\n    if (block.blockId !== 0) {\n      $.ajax({\n        url: `${apiUrl}/block/${window.cvId}/${block.zone}/${block.blockId}`,\n        method: 'PUT',\n        data: block,\n        success: (data) => {\n          cb(true);\n        },\n        complete: () => {},\n        error: () => {}\n      });\n    } else {\n      $.ajax({\n        url: `${apiUrl}/block/${window.cvId}/${block.zone}`,\n        method: 'POST',\n        data: block,\n        success: (data) => {\n          cb(true);\n        },\n        complete: () => {},\n        error: () => {}\n      });\n    }\n  }\n}"]}
=======
{"version":3,"sources":["../babel/app.js"],"names":["document","addEventListener","e","loadTemplate","$","on","copyTextarea","querySelector","select","successful","execCommand","msg","addClass","setTimeout","removeClass","err","API","getCv","data","domParser","DOMParser","template","parseFromString","templateHtml","getElementById","templateStyles","getElementsByTagName","prepend","append","window","isEditing","prepareToEditTemplate","statusBarDom","statusBar","StatusBar","zones","i","length","Zone","blocks","Block","element","_element","_timer","_undoChanges","closeButton","_hide","bind","undoButton","_undo","_isActive","message","classList","remove","messageEl","innerHTML","_show","Promise","resolve","reject","error","add","clearTimeout","zone","_addBlock","_createAddBlock","_enableDragNDrop","zoneName","getAttribute","zoneTypes","JSON","parse","blockWrapper","createElement","button","_showAddBlockList","appendChild","zonesList","type","listItem","_addNewBlock","listImg","setAttribute","location","origin","listName","name","getBlock","block","newBlock","find","before","showMessage","sortable","connectWith","items","handle","cancel","helper","appendTo","zIndex","delay","placeholder","activate","ui","beforeStop","change","create","deactivate","out","over","receive","item","types","target","map","obj","indexOf","sender","hasClass","sort","start","undefined","stop","update","_blockType","dataset","blockType","_childBlockType","_createControls","_fixPlaceholders","childBlockType","_createMicroBlockControls","_enableMicroBlockDragNDrop","blockActionsWrapper","itemPlaceholder","moveButton","editButton","edit","deleteButton","delete","saveButton","save","firstChild","removeChild","placeholders","el","html","deleteMicroBlock","_addMicroBlock","editableElements","querySelectorAll","key","toggle","_isEditing","sliders","parent","slider","range","min","max","after","_toggleEditing","counter","blockId","keysCount","sameKeysCount","j","push","console","log","saveBlock","then","deleteBlock","parentNode","detach","cb","ajax","url","templateUrl","success","complete","apiUrl","templateId","decodeURIComponent","replace","cvId","method"],"mappings":"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","file":"app.js","sourcesContent":["document.addEventListener(\"DOMContentLoaded\", (e) => {\n  loadTemplate();\n});\n\n$('.edit-url-btn').on('click', () => {\n  var copyTextarea = document.querySelector('.edit-url');\n  copyTextarea.select();\n\n  try {\n    var successful = document.execCommand('copy');\n    var msg = successful ? 'successful' : 'unsuccessful';\n\n    $('.text-copied').addClass('active');\n    setTimeout(function() {\n      $('.text-copied').removeClass('active');\n    }, 500);\n  } catch (err) {}\n});\n\nlet loadTemplate = () => {\n  API.getCv((data) => {\n    let domParser = new DOMParser();\n    let template = domParser.parseFromString(data, \"text/html\");\n    let templateHtml = template.getElementById('main-wrap');\n    let templateStyles = template.getElementsByTagName('link');\n\n    //Add template HTML\n    $('#template').prepend(templateHtml);\n\n    //Add template styles\n    $('head').append(templateStyles);\n\n    if(window.isEditing) {\n      prepareToEditTemplate();\n    }\n\n    //Add timeout to remove twitches after loading template\n    setTimeout(() => {\n      $('#loader').removeClass('active');\n    }, 1000);\n  });\n}\n\nlet prepareToEditTemplate = () => {\n  let statusBarDom = $('#status-bar');\n  window.statusBar = new StatusBar(statusBarDom);\n\n  //Setup zones\n  let zones = $('[data-zone-block-types]');\n  for (let i = 0; i < zones.length; i++) {\n    new Zone(zones[i]);\n  }\n\n  //Setup blocks\n  let blocks = $('[data-block-id]');\n  for (let i = 0; i < blocks.length; i++) {\n    new Block(blocks[i]);\n  }\n}\n\nclass StatusBar {\n  constructor(element) {\n    this._element = element[0];\n    \n    var _timer;\n    var _undoChanges = false;\n\n    let closeButton = this._element.querySelector('.close');\n    closeButton.addEventListener('click', this._hide.bind(this), false);\n    \n    let undoButton = this._element.querySelector('.action');\n    undoButton.addEventListener('click', this._undo.bind(this), false);\n\n    this._isActive = false;\n  }\n\n  showMessage(message) {\n    this._element.classList.remove('is-error');\n\n    let messageEl = this._element.querySelector('.message');\n    messageEl.innerHTML = message;\n    this._show();\n    \n    return new Promise((resolve, reject) => {  \n      _timer = setTimeout(() => {        \n        this._hide();\n        resolve();\n      }, 5000);\n    });\n  }\n\n  showError(error) {\n    this._element.classList.add('is-error');\n\n    let messageEl = this._element.querySelector('.message');\n    messageEl.innerHTML = error;\n\n    this._show();\n  }\n\n  _show() {\n    this._element.classList.add('is-active');\n    this._isActive = true;\n  }\n\n  _hide() {\n    this._element.classList.remove('is-active');\n    this._isActive = false;\n  }\n  \n  _undo() {\n    window.clearTimeout(_timer);\n    this._hide();\n    \n  }\n}\n\nclass Zone {\n  constructor(zone) {\n    this._addBlock = null;\n    this._element = zone;\n\n    this._createAddBlock();\n    this._enableDragNDrop();\n  }\n\n  _createAddBlock() {\n    const zoneName = this._element.getAttribute('data-zone');\n    const zoneTypes = JSON.parse(this._element.getAttribute('data-zone-block-types'));\n\n    let blockWrapper = document.createElement('div');\n    blockWrapper.classList.add('add-block');\n\n    let button = document.createElement('button');\n    button.innerHTML = 'Add block';\n    button.addEventListener('click', this._showAddBlockList.bind(this), false);\n    blockWrapper.appendChild(button);\n\n    let zonesList = document.createElement('ul');\n    zonesList.classList.add('add-block-items', 'clearfix');\n    blockWrapper.appendChild(zonesList)\n\n    for(let type of zoneTypes) {\n      let listItem = document.createElement('li');\n      listItem.addEventListener('click', () => this._addNewBlock(zoneName, type), false);\n\n      let listImg = document.createElement('img');\n      listImg.classList.add('icon');\n      listImg.setAttribute('src', `${window.location.origin}/img/add-block-${type.type}.png`);\n      listItem.appendChild(listImg);\n\n      let listName = document.createElement('span');\n      listName.classList.add('title');\n      listName.innerHTML = type.name;\n      listItem.appendChild(listName);\n\n      zonesList.appendChild(listItem);\n    }\n\n    this._element.appendChild(blockWrapper);\n    this._addBlock = blockWrapper;\n  }\n\n  _showAddBlockList() {\n    this._addBlock.classList.add('is-active');\n  }\n\n  _addNewBlock(zoneName, type) {\n    this._addBlock.classList.remove('is-active');\n\n    API.getBlock(type.type, (block) => {\n      let newBlock = $(block)[0];\n\n      $(`[data-zone=\"${zoneName}\"]`).find('.add-block').before(newBlock);\n      new Block(newBlock);\n\n      window.statusBar.showMessage(`You have just added ${type.name} block`);\n    });\n  }\n\n  _enableDragNDrop() {\n    $(this._element).sortable({\n      connectWith: '[data-zone]',\n      items: '.item',\n      handle: '.move-block',\n      cancel: '',\n      helper: 'clone',\n      appendTo: 'body',\n      zIndex: 10000,\n      delay: 100,\n      placeholder: 'placeholder',\n      activate: (e, ui) => {},\n      beforeStop: (e, ui) => {},\n      change: (e, ui) => {},\n      create: (e, ui) => {},\n      deactivate: (e, ui) => {},\n      out: (e, ui) => {},\n      over: (e, ui) => {},\n      receive: (e, ui) => {\n        let type = $(ui.item).data('blockType');\n        let types = $(e.target).data('zoneBlockTypes').map((obj) => obj.type);\n\n        if (types.indexOf(type) === -1) {\n          $(ui.sender).sortable('cancel');\n        }\n\n        if ($(zones[i]).hasClass('ui-sortable')) {\n          $('[data-zone]').sortable('enable');\n        }\n      },\n      remove: (e, ui) => {},\n      sort: (e, ui) => {},\n      start: (e, ui) => {\n        let type = $(ui.item).data('blockType');\n        let zones = $('[data-zone]');\n\n        for(let i = 0; i < zones.length; i++) {\n          let types = [];\n          if ($(zones[i]).data('zoneBlockTypes') !== undefined) {\n            types = $(zones[i]).data('zoneBlockTypes').map((obj) => obj.type);\n          }\n\n          if (types.indexOf(type) === -1 && $(zones[i]).hasClass('ui-sortable')) {\n            $(zones[i]).sortable('disable');\n          }\n        }\n      },\n      stop: (e, ui) => {},\n      update: (e, ui) => {}\n    });\n  }\n}\n\nclass Block {\n  constructor(block) {\n    this._addBlock = null;\n    this._element = block;\n    this._blockType = block.dataset.blockType;\n    this._childBlockType = null;\n    \n    this._createControls();\n    this._fixPlaceholders();\n\n    if ($(block).find('[data-key=\"blocks\"]').length != 0) {\n      this._childBlockType = $(block).find('[data-key=\"blocks\"]')[0].dataset.childBlockType;\n\n      this._createMicroBlockControls();\n      this._enableMicroBlockDragNDrop();\n      this._createAddBlock();\n    }\n  }\n\n  _createControls() {\n    let blockWrapper = document.createElement('div');\n    blockWrapper.classList.add('editable-block');\n\n    let blockActionsWrapper = document.createElement('div');\n    blockActionsWrapper.classList.add('block-actions');\n    blockWrapper.appendChild(blockActionsWrapper);\n\n    let itemPlaceholder = document.createElement('div');\n    itemPlaceholder.classList.add('item-placeholder');\n    itemPlaceholder.innerHTML = this._element.innerHTML;\n    blockWrapper.appendChild(itemPlaceholder);\n\n    if (JSON.parse(this._element.getAttribute('data-is-draggable')) === true) {\n      let moveButton = document.createElement('button');\n      moveButton.classList.add('move', 'move-block');\n      blockActionsWrapper.appendChild(moveButton);\n    }\n\n    if (JSON.parse(this._element.getAttribute('data-is-editable')) === true) {\n      let editButton = document.createElement('button');\n      editButton.classList.add('edit');\n      editButton.innerHTML = 'Edit';\n      editButton.addEventListener('click', this.edit.bind(this), false);\n      blockActionsWrapper.appendChild(editButton);\n    }\n\n    if (JSON.parse(this._element.getAttribute('data-is-deletable')) === true) {\n      let deleteButton = document.createElement('button');\n      deleteButton.classList.add('delete');\n      deleteButton.innerHTML = 'Delete';\n      deleteButton.addEventListener('click', this.delete.bind(this), false);\n      blockActionsWrapper.appendChild(deleteButton);\n    }\n\n    if (JSON.parse(this._element.getAttribute('data-is-editable')) === true) {\n      let saveButton = document.createElement('button');\n      saveButton.classList.add('save');\n      saveButton.innerHTML = 'Save';\n      saveButton.addEventListener('click', this.save.bind(this), false);\n      blockActionsWrapper.appendChild(saveButton);\n    }\n\n    while (this._element.firstChild) {\n      this._element.removeChild(this._element.firstChild);\n    }\n\n    this._element.appendChild(blockWrapper);\n  }\n\n  _fixPlaceholders() {\n    let placeholders = $(this._element).find('[data-placeholder]');\n    for(let i = 0; i < placeholders.length; i++) {\n      let el = $(placeholders[i])[0];\n      let placeholder = el.dataset.placeholder;\n      if(el.innerHTML.indexOf('{{') > -1) {\n        $(el).html(placeholder);\n      }\n    }\n  }\n\n  _createMicroBlockControls() {\n    $('[data-key=\"blocks\"] > div, [data-key=\"blocks\"] > li').addClass('editable-micro-block');\n\n    let blockActionsWrapper = document.createElement('div');\n    blockActionsWrapper.classList.add('block-actions');\n\n    let moveButton = document.createElement('button');\n    moveButton.classList.add('move', 'move-micro-block');\n    blockActionsWrapper.appendChild(moveButton);\n\n    let deleteButton = document.createElement('button');\n    deleteButton.classList.add('delete');\n    deleteButton.innerHTML = 'Delete';\n    $(deleteButton).on('click', this.deleteMicroBlock.bind(this));\n    blockActionsWrapper.appendChild(deleteButton);\n\n    $('[data-key=\"blocks\"] > div, [data-key=\"blocks\"] > li').remove('.block-actions');\n    $('[data-key=\"blocks\"] > div, [data-key=\"blocks\"] > li').append(blockActionsWrapper);\n  }\n\n  _enableMicroBlockDragNDrop() {\n    $('[data-key=\"blocks\"]').sortable({\n      // connectWith: '',\n      items: '> div, > li',\n      handle: '.move-micro-block',\n      cancel: '',\n      // helper: 'clone',\n      appendTo: 'body',\n      zIndex: 10000,\n      delay: 100,\n      placeholder: 'placeholder',\n      activate: (e, ui) => {},\n      beforeStop: (e, ui) => {},\n      change: (e, ui) => {},\n      create: (e, ui) => {},\n      deactivate: (e, ui) => {},\n      out: (e, ui) => {},\n      over: (e, ui) => {},\n      receive: (e, ui) => {},\n      remove: (e, ui) => {},\n      sort: (e, ui) => {},\n      start: (e, ui) => {},\n      stop: (e, ui) => {},\n      update: (e, ui) => {}\n    });\n  }\n\n  _createAddBlock() {\n    let blockWrapper = document.createElement('div');\n    blockWrapper.classList.add('add-micro-block');\n\n    let button = document.createElement('button');\n    button.innerHTML = 'Add Micro block';\n    button.addEventListener('click', this._addMicroBlock.bind(this), false);\n    blockWrapper.appendChild(button);\n    $(this._element).find('.editable-block').append(blockWrapper);\n  }\n\n  _addMicroBlock() {\n    API.getBlock(this._childBlockType, (block) => {\n      $(this._element).find('[data-key=\"blocks\"]').append(block);\n      this._createMicroBlockControls();\n      this._fixPlaceholders();\n\n      //TODO: refactor edit function\n      let editableElements = this._element.querySelectorAll('[data-key]');\n      for (let i = 0; i < editableElements.length; i++) {\n        const key = editableElements[i].getAttribute('data-key');\n        if(['skill', 'blocks'].indexOf(key) === -1) {\n          editableElements[i].setAttribute('contenteditable', true);\n        }\n      }\n    });\n  }\n\n  _toggleEditing() {\n    this._element.querySelector('.editable-block').classList.toggle('is-editing');\n    this._isEditing = !this._isEditing;\n  }\n\n  edit() {\n    let editableElements = this._element.querySelectorAll('[data-key]');\n    for (let i = 0; i < editableElements.length; i++) {\n      const key = editableElements[i].getAttribute('data-key');\n      if(['blocks'].indexOf(key) === -1) {\n        editableElements[i].setAttribute('contenteditable', true);\n      }\n    }\n\n    // console.log($(this._element).find('.skills'))\n\n\n    let sliders = $(this._element).find('.skills'); //.after(slider);\n    for(let i = 0; i < sliders.length; i++) {\n      // console.log($(sliders[i]).parent().find('.slider').length)\n      if($(sliders[i]).parent().find('.slider').length === 0) {\n        let slider = document.createElement('div');\n        slider.classList.add('slider');\n        $(slider).slider({\n          range: 'max',\n          min: 0,\n          max: 10\n        });\n        $(sliders[i]).after(slider);\n      }\n    }\n\n    this._toggleEditing();\n  }\n\n  save() {\n    let editableElements = this._element.querySelectorAll('[data-key]');\n\n    //Data saving\n    let counter = 0;\n    let data = {};\n    data['blockId'] = this._element.dataset.blockId || 0;\n    data['blockType'] = this._element.dataset.blockType;\n    data['zone'] = $(this._element).parent().data('zone'); \n    data['fields'] = {};\n    for (let i = 0; i < editableElements.length; i++) {\n      if(['blocks'].indexOf(editableElements[i].getAttribute('data-key')) === -1) {\n        editableElements[i].setAttribute('contenteditable', false);\n      }\n\n      if(editableElements[i].getAttribute('data-key') !== 'blocks') {\n        if(data['fields']['blocks'] !== undefined) {  \n          const keysCount = $(this._element).find('[data-key=\"blocks\"]').find('[data-key]');\n          const sameKeysCount = $(this._element).find('[data-key=\"blocks\"]').find('[data-key=\"' + keysCount[0].getAttribute('data-key') + '\"]')\n          // console.log(keysCount.length, sameKeysCount.length);\n          let obj = {};\n          for(let j = 0; j < (keysCount.length / sameKeysCount.length); j++) {\n            obj[editableElements[i + j].getAttribute('data-key')] = editableElements[i + j].innerHTML;  \n            // console.log(i, j);\n          }\n\n          i+= keysCount.length / sameKeysCount.length - 1;\n          // console.log(obj);\n          data['fields']['blocks'].push(obj);\n        }\n        else {\n          data['fields'][editableElements[i].getAttribute('data-key')] = editableElements[i].innerHTML;  \n        }\n      }\n      else {\n        data['fields']['blocks'] = [];\n      }\n    }\n\n    console.log(data);\n    API.saveBlock(data, () => {\n\n    });\n\n    this._toggleEditing();\n  }\n\n  delete() {\n    let blockId = this._element.getAttribute('data-block-id');\n    var element = this._element;\n\n    window.statusBar.showMessage('You have just deleted block').then(function () {\n      API.deleteBlock(blockId, () => {\n        element.parentNode.removeChild(element);  \n      });\n    });\n\n  }\n\n  deleteMicroBlock(e) {\n    $(e.target).parent().parent().detach();\n  }\n};\n\nconst API = {\n  getCv: (cb) => {\n    $.ajax({\n      url: window.templateUrl,\n      success: (data) => {\n        cb(data);\n      },\n      complete: () => {},\n      error: () => {}\n    });\n  },\n\n  getBlock: (type, cb) => {\n    $.ajax({\n      url: `${apiUrl}/block/${window.templateId}/${type}`,\n      success: (data) => {\n        let block = decodeURIComponent(JSON.parse(data).data).replace(/\\+/g, ' ');\n\n        cb(block);\n      },\n      complete: () => {},\n      error: () => {}\n    });\n  },\n\n  saveBlock: (block, cb) => {\n    block.cvId = cvId;\n\n    if (block.blockId !== 0) {\n      $.ajax({\n        url: `${apiUrl}/block/${window.cvId}/${block.zone}/${block.blockId}`,\n        method: 'PUT',\n        data: block,\n        success: (data) => {\n          cb(true);\n        },\n        complete: () => {},\n        error: () => {}\n      });\n    } else {\n      $.ajax({\n        url: `${apiUrl}/block/${window.cvId}/${block.zone}`,\n        method: 'POST',\n        data: block,\n        success: (data) => {\n          cb(true);\n        },\n        complete: () => {},\n        error: () => {}\n      });\n    }\n  },\n  \n  deleteBlock: (blockId, cb) => {\n    if (blockId !== undefined) {\n      $.ajax({\n        url: `${apiUrl}/block/${blockId}`,\n        method: 'DELETE',\n        success: (data) => {\n          cb(true);\n        },\n        complete: () => {},\n        error: () => {}\n      });\n    }\n  }\n}"]}
>>>>>>> 36e39ed67adcb24d7e3042b1dc46d5326088fafd
