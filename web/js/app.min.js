function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function trackEvent(e,t){ga("send","event",e,t)}function setCheckIcon(e,t){$(e).each(function(){$(this).css("display","none")}),$(t).css("display","block")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),_isEditing=!1,_isChanged=!1;document.addEventListener("DOMContentLoaded",function(e){var t=$("#status-bar");window.statusBar=new StatusBar(t),loadTemplate(window.templateId),"#published"===window.location.hash&&document.referrer===editUrl&&$(".container-message").css("display","block")}),$(window).bind("beforeunload",function(){if(_isEditing)return"Are you sure you want to leave? There are some unpublished changes."}),$(".edit-url-btn").on("click",function(){document.querySelector(".edit-url").select();try{document.execCommand("copy");$(".text-copied").addClass("active"),setTimeout(function(){$(".text-copied").removeClass("active")},500)}catch(e){}}),$(".template").on("click",function(e){trackEvent("CV","Template changed: "+e.currentTarget.attributes[2].value);var t=e.currentTarget.attributes[1].value,a=$(e.target).parent().find(".check-icon");_isEditing?($("#myModal .modal-descriptipn").text("Your changes will not be saved if you swich template."),$("#myModal").modal("show"),$("#myModal").on("click","button",function(e){"cancel"===e.currentTarget.getAttribute("data-action")?$("#myModal").modal("hide"):(_isEditing=!1,loadTemplate(t),setCheckIcon(".templates-list .check-icon",a),$("#myModal").modal("hide"))})):_isChanged?($("#myModal .modal-descriptipn").text("Are you sure you want to leave? There are some unpublished changes."),$("#myModal").modal("show"),$("#myModal").on("click","button",function(e){"cancel"===e.currentTarget.getAttribute("data-action")?$("#myModal").modal("hide"):(_isChanged=!1,loadTemplate(t),setCheckIcon(".templates-list .check-icon",a),$("#myModal").modal("hide"))})):(loadTemplate(t),setCheckIcon(".templates-list .check-icon",a))}),$("#publish-button").on("click",function(e){API.publishTemplate(function(e){window.location.href=templateUrl+"#published"})}),$(".themes-list").on("click",".themes-listitem",function(e){trackEvent("CV","Theme changed");var t=$(e.currentTarget).data("themeSource"),a=$(e.target).parent().find(".check-icon"),n=$(e.currentTarget).data("themeId");$(".themes-list").find(".check-icon").each(function(){$(this).css("display","none")}),API.updateTheme(n,function(e){}),$(a).css("display","block"),loadTheme(t)}),$(".topbar-feedback").on("click",function(e){$("#feedbackModal").modal("show")}),$("#feedback-form").submit(function(e){var t=$("#feedback-text").val();$.trim(t)&&API.sendFeedback(t,function(e){$("#feedback-text").val(""),$("#feedbackModal").modal("hide"),window.statusBar.showMessage("Your feedback was sent successfully. Thank you for your time!",!0).then(function(){})},function(e){$("#feedback-text").val(""),$("#feedbackModal").modal("hide"),window.statusBar.showError("Your feedback was unsuccessfully sent. Please try later!",!0).then(function(){})}),e.preventDefault()});var loadTheme=function(e){$("head").append('<link href="/templates/'+e+'" rel="stylesheet">')},loadTemplate=function(e){window.templateId=e,activateLoader(),API.getCv(e,function(e){var t=(new DOMParser).parseFromString(e.html,"text/html"),a=t.getElementById("main-wrap"),n=t.getElementsByTagName("link");$("head").find("link").slice(2).remove(),$("head").append(n),$(".themes-list").html(e.themes),setTimeout(function(){$("#loader").removeClass("active"),$("#template").html(a),window.isEditing&&prepareToEditTemplate(),toggleDateElements(),setPlaceholders(),pasteListeners()},1e3)})},pasteListeners=function(){for(var e=$("body").find("[data-key]"),t=0;t<e.length;t++){var a=e[t].getAttribute("data-key");"blocks"!==a&&"skill"!==a&&e[t].addEventListener("paste",function(e){e.preventDefault();e.currentTarget;var t=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)},!1)}},toggleDateElements=function(){for(var e=$("body").find("[data-placeholder]"),t=0;t<e.length;t++){var a=$(e[t]);"Date from"==a[0].getAttribute("data-placeholder")&&"Date from"==a.html()?a[0].classList.add("hidden"):"Date to"==a[0].getAttribute("data-placeholder")&&"Date to"==a.html()&&(a[0].parentElement.children[1].classList.add("hidden"),a[0].classList.add("hidden"))}},setPlaceholders=function(){for(var e=$("body").find("[data-placeholder]"),t=0;t<e.length;t++){var a=$(e[t]);if(""==a.html()){var n=a.data("placeholder");a.html(n)}}},stripTags=function(e){var t=/(<([^>]+)>)/gi;return e=e.replace(t,""),t=/&(.*?);/gi,e=e.replace(t,"")},prepareToEditTemplate=function(){for(var e=$("[data-zone-block-types]"),t=0;t<e.length;t++)new Zone(e[t]);for(var a=$("[data-block-id]"),n=0;n<a.length;n++)new Block(a[n])},preapareBlockToEdit=function(e){new Block(e)},activateLoader=function(){var e=document.createElement("div"),t=document.createElement("div");e.setAttribute("id","loader"),e.setAttribute("class","active"),t.setAttribute("class","signal"),e.append(t),$("#template").append(e)},applySliders=function(e){for(var t=$(e).find(".skills"),a=0;a<t.length;a++)if(0===$(t[a]).parent().find(".slider").length){var n=document.createElement("div");n.classList.add("slider");var i=$(t[a]).parent(".skills-group").attr("data-value");$(n).slider({range:"max",min:0,max:10,value:i,slide:function(e,t){t.value;$(this).parent(".skills-group").attr("data-value",t.value)}}),$(t[a]).after(n)}},StatusBar=function(){function e(t){_classCallCheck(this,e),this._element=t[0];this._element.querySelector(".close").addEventListener("click",this._hide.bind(this),!1),this.undoButton=this._element.querySelector(".action"),this._isActive=!1}return _createClass(e,[{key:"showMessage",value:function(e,t){var a=this;return this._element.classList.remove("is-error"),t?this.undoButton.classList.add("hidden"):this.undoButton.classList.remove("hidden"),this._element.querySelector(".message").innerHTML=e,this._show(),new Promise(function(e,t){_timer=setTimeout(function(){a._hide(),e()},1500),Rx.Observable.fromEvent(a.undoButton,"click").subscribe(function(){window.clearTimeout(_timer),a._hide(),t()})})}},{key:"showError",value:function(e){var t=this;return this._element.classList.add("is-error"),this._element.querySelector(".message").innerHTML=e,this._show(),new Promise(function(e,a){setTimeout(function(){t._hide(),e()},1500)})}},{key:"_show",value:function(){$(this._element).show("slow"),this._isActive=!0}},{key:"_hide",value:function(){$(this._element).hide("slow"),this._isActive=!1}}]),e}(),Zone=function(){function e(t){_classCallCheck(this,e),this._addBlock=null,this._element=t,this._createAddBlock(),this._enableDragNDrop()}return _createClass(e,[{key:"_createAddBlock",value:function(){var e=this,t=this._element.getAttribute("data-zone"),a=JSON.parse(this._element.getAttribute("data-zone-block-types")),n=document.createElement("div");n.classList.add("add-block");var i=document.createElement("button");i.innerHTML="Add block",i.addEventListener("click",this._showAddBlockList.bind(this),!1),n.appendChild(i);var l=document.createElement("ul");l.classList.add("add-block-items","clearfix"),n.appendChild(l);var o=!0,c=!1,d=void 0;try{for(var s,r=a[Symbol.iterator]();!(o=(s=r.next()).done);o=!0)!function(){var a=s.value,n=document.createElement("li");n.addEventListener("click",function(){return e._addNewBlock(t,a)},!1);var i=document.createElement("img");i.classList.add("icon"),i.setAttribute("src",window.location.origin+"/img/add-block-"+a.type+".png"),n.appendChild(i);var o=document.createElement("span");o.classList.add("title"),o.innerHTML=a.name,n.appendChild(o),l.appendChild(n)}()}catch(e){c=!0,d=e}finally{try{!o&&r.return&&r.return()}finally{if(c)throw d}}this._element.appendChild(n);var u=document.createElement("a");u.classList.add("active","cancel-button"),u.innerHTML="Cancel",u.addEventListener("click",this._hideAddBlockList.bind(this),!1),n.appendChild(u),this._addBlock=n}},{key:"_showAddBlockList",value:function(){this._addBlock.classList.add("is-active")}},{key:"_hideAddBlockList",value:function(){this._addBlock.classList.remove("is-active")}},{key:"_addNewBlock",value:function(e,t){trackEvent("CV","Add block: "+t.name),this._addBlock.classList.remove("is-active"),API.getBlock(t.type,function(a){var n=$(a)[0];$('[data-zone="'+e+'"]').find(".add-block").before(n),new Block(n),n.firstChild.classList.add("is-editing");for(var i=n.querySelectorAll("[data-key]"),l=0;l<i.length;l++){var o=i[l].getAttribute("data-key");-1===["blocks"].indexOf(o)&&"skill"!=o&&i[l].setAttribute("contenteditable",!0)}_isEditing=!0,applySliders(n),setPlaceholders(),window.statusBar.showMessage("You have just added "+t.name+" block",!0).then(function(){})})}},{key:"_enableDragNDrop",value:function(){$(this._element).sortable({connectWith:"[data-zone]",items:".item",handle:".move-block",cancel:"",helper:"clone",appendTo:"body",zIndex:1e4,delay:100,placeholder:"placeholder",activate:function(e,t){},beforeStop:function(e,t){},change:function(e,t){},create:function(e,t){},deactivate:function(e,t){},out:function(e,t){},over:function(e,t){},receive:function(e,t){var a=$(t.item).data("blockType");-1===$(e.target).data("zoneBlockTypes").map(function(e){return e.type}).indexOf(a)&&$(t.sender).sortable("cancel")},remove:function(e,t){},sort:function(e,t){},start:function(e,t){for(var a=$(t.item).data("blockType"),n=$("[data-zone]"),i=0;i<n.length;i++){var l=[];$(n[i]);void 0!==$(n[i]).data("zoneBlockTypes")&&(l=$(n[i]).data("zoneBlockTypes").map(function(e){return e.type})),-1===l.indexOf(a)&&$(n[i]).hasClass("ui-sortable")&&$(n[i]).sortable("disable")}},stop:function(e,t){for(var a=$("[data-zone]"),n=0;n<a.length;n++)$(a[n]).hasClass("ui-sortable")&&$(a[n]).sortable("enable")},update:function(e,t){for(var a=t.item.parent("[data-zone]"),n=$(a).data("zone"),i=a.find("[data-block-id]"),l=[],o=0;o<i.length;o++){var c=$(i[o]).data("blockId");l.push(c)}API.sortBlocks(n,l,function(){})}})}}]),e}(),Block=function(){function e(t){_classCallCheck(this,e),this._addBlock=null,this._element=t,this._blockType=t.dataset.blockType,this._childBlockType=null,this._createControls(),this._fixPlaceholders(),0!=$(t).find('[data-key="blocks"]').length&&(this._childBlockType=$(t).find('[data-key="blocks"]')[0].dataset.childBlockType,this._createMicroBlockControls(),this._enableMicroBlockDragNDrop(),this._createAddBlock())}return _createClass(e,[{key:"_createControls",value:function(){var e=document.createElement("div");e.classList.add("editable-block");var t=document.createElement("div");t.classList.add("block-actions--left-side"),e.appendChild(t);var a=document.createElement("div");a.classList.add("block-actions"),e.appendChild(a);var n=document.createElement("div");if(n.classList.add("item-placeholder"),n.innerHTML=this._element.innerHTML,e.appendChild(n),!0===JSON.parse(this._element.getAttribute("data-is-draggable"))){var i=document.createElement("button");i.classList.add("move","move-block"),a.appendChild(i)}if(!0===JSON.parse(this._element.getAttribute("data-is-editable"))){var l=document.createElement("button");l.classList.add("edit"),l.innerHTML="Edit",l.addEventListener("click",this.edit.bind(this),!1),a.appendChild(l)}if(!0===JSON.parse(this._element.getAttribute("data-is-deletable"))){var o=document.createElement("button");o.classList.add("delete"),o.innerHTML="Delete",o.addEventListener("click",this.delete.bind(this),!1),a.appendChild(o)}if(!0===JSON.parse(this._element.getAttribute("data-is-editable"))){var c=document.createElement("button");c.classList.add("cancel"),c.innerHTML="Cancel",c.addEventListener("click",this.cancel.bind(this),!1),t.appendChild(c)}if(!0===JSON.parse(this._element.getAttribute("data-is-editable"))){var d=document.createElement("button");d.classList.add("save"),d.innerHTML="Save",d.addEventListener("click",this.save.bind(this),!1),a.appendChild(d)}for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element.appendChild(e)}},{key:"_fixPlaceholders",value:function(){for(var e=$(this._element).find("[data-placeholder]"),t=0;t<e.length;t++){var a=$(e[t])[0],n=a.dataset.placeholder;a.innerHTML.indexOf("{{")>-1&&$(a).html(n)}}},{key:"_createMicroBlockControls",value:function(){$('[data-key="blocks"] > div, [data-key="blocks"] > li').addClass("editable-micro-block");var e=document.createElement("div");e.classList.add("block-actions");var t=document.createElement("button");t.classList.add("move","move-micro-block"),e.appendChild(t);var a=document.createElement("button");a.classList.add("delete"),a.innerHTML="Delete",$(a).on("click",this.deleteMicroBlock.bind(this)),e.appendChild(a),$('[data-key="blocks"] > div, [data-key="blocks"] > li').remove(".block-actions"),$('[data-key="blocks"] > div, [data-key="blocks"] > li').append(e)}},{key:"_enableMicroBlockDragNDrop",value:function(){$('[data-key="blocks"]').sortable({items:"> div, > li",handle:".move-micro-block",cancel:"",appendTo:"body",zIndex:1e4,delay:100,placeholder:"placeholder",activate:function(e,t){},beforeStop:function(e,t){},change:function(e,t){},create:function(e,t){},deactivate:function(e,t){},out:function(e,t){},over:function(e,t){},receive:function(e,t){},remove:function(e,t){},sort:function(e,t){},start:function(e,t){},stop:function(e,t){},update:function(e,t){}})}},{key:"_createAddBlock",value:function(){var e=document.createElement("div");e.classList.add("add-micro-block");var t=document.createElement("button");t.innerHTML="Add Micro block",t.addEventListener("click",this._addMicroBlock.bind(this),!1),e.appendChild(t),$(this._element).find(".editable-block").append(e)}},{key:"_addMicroBlock",value:function(){var e=this;trackEvent("CV","Add micro block"),API.getBlock(this._childBlockType,function(t){$(e._element).find('[data-key="blocks"]').append(t),e._createMicroBlockControls(),e._fixPlaceholders(),applySliders(e._element),setPlaceholders();for(var a=e._element.querySelectorAll("[data-key]"),n=0;n<a.length;n++){var i=a[n].getAttribute("data-key");-1===["skill","blocks"].indexOf(i)&&"skill"!=i&&a[n].setAttribute("contenteditable",!0)}})}},{key:"_toggleEditing",value:function(){this._element.querySelector(".editable-block").classList.toggle("is-editing"),_isEditing=!_isEditing}},{key:"edit",value:function(){for(var e=this._element.querySelectorAll("[data-key]"),t=0;t<e.length;t++){var a=e[t].getAttribute("data-key");-1===["blocks"].indexOf(a)&&"skill"!=a&&e[t].setAttribute("contenteditable",!0),e[t].classList.contains("hidden")&&e[t].classList.remove("hidden")}applySliders(this._element),this._toggleEditing()}},{key:"cancel",value:function(){var e=this,t=this._element.querySelectorAll("[data-key]"),a=this._element.getAttribute("data-block-id");if(""==a)$(this._element).remove();else{for(var n=0;n<t.length;n++)-1===["blocks"].indexOf(t[n].getAttribute("data-key"))&&t[n].setAttribute("contenteditable",!1);API.renderBlock(a,function(t){e._toggleEditing(),e._updateHtml(e._element,t.html,!0)})}}},{key:"save",value:function(){var e=this,t=this._element.querySelectorAll("[data-key]"),a={};a.blockId=this._element.dataset.blockId||0,a.blockType=this._element.dataset.blockType,a.zone=$(this._element).parent().data("zone"),a.fields={};for(var n=0;n<t.length;n++)if("blocks"!==t[n].getAttribute("data-key"))if(void 0!==a.fields.blocks){for(var i=$(this._element).find('[data-key="blocks"]').find("[data-key]"),l=$(this._element).find('[data-key="blocks"]').find('[data-key="'+i[0].getAttribute("data-key")+'"]'),o={},c=0;c<i.length/l.length;c++){var d=t[n+c].getAttribute("data-value")?t[n+c].getAttribute("data-value"):t[n+c].innerHTML;o[t[n+c].getAttribute("data-key")]=this.stripTags(d)}n+=i.length/l.length-1,a.fields.blocks.push(o)}else"photo"==t[n].getAttribute("data-key")?function(){var e=t[n].files,i=t[n].getAttribute("data-key");API.uploadPhoto(e,function(e){a.fields[i]=e.photo,$(".photo img").attr("src",e.photo)})}():a.fields[t[n].getAttribute("data-key")]=this.stripTags(t[n].innerHTML);else a.fields.blocks=[];for(var s=0;s<t.length;s++)-1===["blocks"].indexOf(t[s].getAttribute("data-key"))&&(t[s].setAttribute("contenteditable",!1),""==t[s].innerHTML&&(t[s].getAttribute("data-required")?t[s].innerHTML=t[s].getAttribute("data-placeholder"):t[s].classList.add("hidden")));API.saveBlock(a,function(t){e._toggleEditing(),e._updateHtml(e._element,t.html,!0),window.statusBar.showMessage("Block successfully saved.",!0).then(function(){})})}},{key:"stripTags",value:function(e){var t=/(<([^>]+)>)/gi;return e=e.replace(t,""),t=/&(.*?);/gi,e=e.replace(t,"")}},{key:"delete",value:function(){trackEvent("CV","Remove block");var e=this._element.getAttribute("data-block-id"),t=this._element;t.classList.add("hidden"),window.statusBar.showMessage("You have just deleted block",!1).then(function(){API.deleteBlock(e,function(){t.parentNode.removeChild(t)})}).catch(function(e){t.classList.remove("hidden")})}},{key:"deleteMicroBlock",value:function(e){$(e.target).parent().parent().detach()}},{key:"_updateHtml",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];$(e).html(t),setPlaceholders(),toggleDateElements(),a&&preapareBlockToEdit(e)}}]),e}(),API={getCv:function(e,t){var a=apiUrl+"/"+e+"/template";void 0==e&&(a=apiUrl+"/template"),$.ajax({url:a,success:function(e){t(e)},complete:function(){},error:function(){}})},renderBlock:function(e,t){$.ajax({url:apiUrl+"/block/"+e,success:function(e){t(e)},complete:function(){},error:function(){}})},updateTheme:function(e,t){_isChanged=!0;var a={themeId:e,templateId:window.templateId};$.ajax({url:apiUrl+"/theme",method:"PUT",data:a,success:function(e){t(e)},complete:function(){},error:function(){}})},getBlock:function(e,t){_isChanged=!0,$.ajax({url:apiUrl+"/block/"+window.templateId+"/"+e,success:function(e){var a=decodeURIComponent(JSON.parse(e).data).replace(/\+/g," ");t(a)},complete:function(){},error:function(){}})},sendFeedback:function(e,t,a){var n={message:e};$.ajax({url:apiUrl+"/report",method:"POST",data:n,success:function(e){t(e)},complete:function(){},error:function(e){a(e)}})},saveBlock:function(e,t){_isChanged=!0,e.cvId=cvId,e.templateId=window.templateId,0!==e.blockId?$.ajax({url:apiUrl+"/block/"+e.zone,method:"PUT",data:e,success:function(e){t(e)},complete:function(){},error:function(){}}):$.ajax({url:apiUrl+"/block/"+e.zone,method:"POST",data:e,success:function(e){t(e)},complete:function(){},error:function(){}})},uploadPhoto:function(e,t){_isChanged=!0;var a=new FormData;$.each(e,function(e,t){a.append(e,t)}),$.ajax({url:apiUrl+"/photo",method:"POST",data:a,cache:!1,dataType:"json",processData:!1,contentType:!1,async:!1,success:function(e){t(e)}})},deleteBlock:function(e,t){_isChanged=!0,void 0!==e&&$.ajax({url:apiUrl+"/block/"+e,method:"DELETE",success:function(e){t(!0)},complete:function(){},error:function(){}})},sortBlocks:function(e,t,a){_isChanged=!0;var n={};n.wildcard=e,n.positions=t,n.templateId=window.templateId,$.ajax({url:apiUrl+"/zone",method:"PUT",data:n,success:function(e){a(e)},error:function(){},complete:function(){}})},publishTemplate:function(e){_isChanged=!1;var t={templateId:window.templateId};$.ajax({url:apiUrl+"/publish",method:"PUT",data:t,success:function(t){e(t)},error:function(){},complete:function(){}})}};
//# sourceMappingURL=app.min.js.map